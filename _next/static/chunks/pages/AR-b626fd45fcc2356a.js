(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4747:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/AR",function(){return n(7892)}])},7498:function(e,t){"use strict";var n,o;Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{PrefetchKind:function(){return n},ACTION_REFRESH:function(){return l},ACTION_NAVIGATE:function(){return a},ACTION_RESTORE:function(){return r},ACTION_SERVER_PATCH:function(){return i},ACTION_PREFETCH:function(){return u},ACTION_FAST_REFRESH:function(){return c},ACTION_SERVER_ACTION:function(){return s}});let l="refresh",a="navigate",r="restore",i="server-patch",u="prefetch",c="fast-refresh",s="server-action";(o=n||(n={})).AUTO="auto",o.FULL="full",o.TEMPORARY="temporary",("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},30:function(e,t,n){"use strict";function getDomainLocale(e,t,n,o){return!1}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getDomainLocale",{enumerable:!0,get:function(){return getDomainLocale}}),n(2866),("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},5170:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return b}});let o=n(8754),l=o._(n(7294)),a=n(4450),r=n(2227),i=n(4364),u=n(109),c=n(3607),s=n(1823),d=n(9031),f=n(920),p=n(30),g=n(7192),h=n(7498),v=new Set;function prefetch(e,t,n,o,l,a){if(!a&&!(0,r.isLocalURL)(t))return;if(!o.bypassPrefetchedCheck){let l=void 0!==o.locale?o.locale:"locale"in e?e.locale:void 0,a=t+"%"+n+"%"+l;if(v.has(a))return;v.add(a)}let i=a?e.prefetch(t,l):e.prefetch(t,n,o);Promise.resolve(i).catch(e=>{})}function formatStringOrUrl(e){return"string"==typeof e?e:(0,i.formatUrl)(e)}let y=l.default.forwardRef(function(e,t){let n,o;let{href:i,as:v,children:y,prefetch:b=null,passHref:_,replace:m,shallow:E,scroll:x,locale:j,onClick:M,onMouseEnter:P,onTouchStart:O,legacyBehavior:C=!1,...I}=e;n=y,C&&("string"==typeof n||"number"==typeof n)&&(n=l.default.createElement("a",null,n));let A=l.default.useContext(s.RouterContext),R=l.default.useContext(d.AppRouterContext),k=null!=A?A:R,T=!A,w=!1!==b,L=null===b?h.PrefetchKind.AUTO:h.PrefetchKind.FULL,{href:S,as:N}=l.default.useMemo(()=>{if(!A){let e=formatStringOrUrl(i);return{href:e,as:v?formatStringOrUrl(v):e}}let[e,t]=(0,a.resolveHref)(A,i,!0);return{href:e,as:v?(0,a.resolveHref)(A,v):t||e}},[A,i,v]),F=l.default.useRef(S),U=l.default.useRef(N);C&&(o=l.default.Children.only(n));let K=C?o&&"object"==typeof o&&o.ref:t,[D,H,q]=(0,f.useIntersection)({rootMargin:"200px"}),V=l.default.useCallback(e=>{(U.current!==N||F.current!==S)&&(q(),U.current=N,F.current=S),D(e),K&&("function"==typeof K?K(e):"object"==typeof K&&(K.current=e))},[N,K,S,q,D]);l.default.useEffect(()=>{k&&H&&w&&prefetch(k,S,N,{locale:j},{kind:L},T)},[N,S,H,j,w,null==A?void 0:A.locale,k,T,L]);let B={ref:V,onClick(e){C||"function"!=typeof M||M(e),C&&o.props&&"function"==typeof o.props.onClick&&o.props.onClick(e),k&&!e.defaultPrevented&&function(e,t,n,o,a,i,u,c,s,d){let{nodeName:f}=e.currentTarget,p="A"===f.toUpperCase();if(p&&(function(e){let t=e.currentTarget,n=t.getAttribute("target");return n&&"_self"!==n||e.metaKey||e.ctrlKey||e.shiftKey||e.altKey||e.nativeEvent&&2===e.nativeEvent.which}(e)||!s&&!(0,r.isLocalURL)(n)))return;e.preventDefault();let navigate=()=>{let e=null==u||u;"beforePopState"in t?t[a?"replace":"push"](n,o,{shallow:i,locale:c,scroll:e}):t[a?"replace":"push"](o||n,{forceOptimisticNavigation:!d,scroll:e})};s?l.default.startTransition(navigate):navigate()}(e,k,S,N,m,E,x,j,T,w)},onMouseEnter(e){C||"function"!=typeof P||P(e),C&&o.props&&"function"==typeof o.props.onMouseEnter&&o.props.onMouseEnter(e),k&&(w||!T)&&prefetch(k,S,N,{locale:j,priority:!0,bypassPrefetchedCheck:!0},{kind:L},T)},onTouchStart(e){C||"function"!=typeof O||O(e),C&&o.props&&"function"==typeof o.props.onTouchStart&&o.props.onTouchStart(e),k&&(w||!T)&&prefetch(k,S,N,{locale:j,priority:!0,bypassPrefetchedCheck:!0},{kind:L},T)}};if((0,u.isAbsoluteUrl)(N))B.href=N;else if(!C||_||"a"===o.type&&!("href"in o.props)){let e=void 0!==j?j:null==A?void 0:A.locale,t=(null==A?void 0:A.isLocaleDomain)&&(0,p.getDomainLocale)(N,e,null==A?void 0:A.locales,null==A?void 0:A.domainLocales);B.href=t||(0,g.addBasePath)((0,c.addLocale)(N,e,null==A?void 0:A.defaultLocale))}return C?l.default.cloneElement(o,B):l.default.createElement("a",{...I,...B},n)}),b=y;("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},920:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"useIntersection",{enumerable:!0,get:function(){return useIntersection}});let o=n(7294),l=n(3436),a="function"==typeof IntersectionObserver,r=new Map,i=[];function useIntersection(e){let{rootRef:t,rootMargin:n,disabled:u}=e,c=u||!a,[s,d]=(0,o.useState)(!1),f=(0,o.useRef)(null),p=(0,o.useCallback)(e=>{f.current=e},[]);(0,o.useEffect)(()=>{if(a){if(c||s)return;let e=f.current;if(e&&e.tagName){let o=function(e,t,n){let{id:o,observer:l,elements:a}=function(e){let t;let n={root:e.root||null,margin:e.rootMargin||""},o=i.find(e=>e.root===n.root&&e.margin===n.margin);if(o&&(t=r.get(o)))return t;let l=new Map,a=new IntersectionObserver(e=>{e.forEach(e=>{let t=l.get(e.target),n=e.isIntersecting||e.intersectionRatio>0;t&&n&&t(n)})},e);return t={id:n,observer:a,elements:l},i.push(n),r.set(n,t),t}(n);return a.set(e,t),l.observe(e),function(){if(a.delete(e),l.unobserve(e),0===a.size){l.disconnect(),r.delete(o);let e=i.findIndex(e=>e.root===o.root&&e.margin===o.margin);e>-1&&i.splice(e,1)}}}(e,e=>e&&d(e),{root:null==t?void 0:t.current,rootMargin:n});return o}}else if(!s){let e=(0,l.requestIdleCallback)(()=>d(!0));return()=>(0,l.cancelIdleCallback)(e)}},[c,n,t,s,f.current]);let g=(0,o.useCallback)(()=>{d(!1)},[]);return[p,s,g]}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},7892:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return index_page}});var o=n(5893),l=n(8583),a=n(1664),r=n.n(a),i=n(7294),u=n(6221),c=n(3483),s=n(6819),d=n(5123),f=n.n(d),ar_page=()=>{let[e]=(0,l.KO)(u.LF),[t,n]=(0,l.KO)(u.ge),[a,d]=(0,i.useState)(null),p=(0,i.useCallback)(async()=>{if(null===t.latitude||null===t.longitude)return;let e=t.latitude,n=t.longitude,o=await c.x.posts.$get({query:{latitude:e,longitude:n}}).catch(s.F);d(o),console.log("getPosts")},[t.latitude,t.longitude]);(0,i.useEffect)(()=>{"undefined"!=typeof navigator&&null!==navigator.geolocation&&navigator.geolocation.watchPosition(e=>{n({latitude:e.coords.latitude,longitude:e.coords.longitude})})},[n]);let[g,h]=(0,i.useState)(!0);(0,i.useEffect)(()=>{if(g&&null!==t.latitude&&null!==t.longitude){let oneRendaringGetPosts=async()=>{let e=t.latitude,n=t.longitude,o=await c.x.posts.$get({query:{latitude:e,longitude:n}}).catch(s.F);d(o)};oneRendaringGetPosts(),h(!1)}},[t.latitude,t.longitude,g]);let[v,y]=(0,i.useState)(0),b=(0,i.useCallback)(async t=>{if((null==e?void 0:e.id)===void 0||void 0===t)return;let n=await c.x.posts.$post({body:{postId:t,userId:e.id}});console.log("result",n),y(n),await p(),console.log("result",n),console.log("likecount",v)},[p,v,null==e?void 0:e.id]);(0,i.useEffect)(()=>{void 0===AFRAME.components["hit-box"]&&AFRAME.registerComponent("hit-box",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let e=this.postId;console.log("postId",e),b(e),console.log("オブジェクトがクリックされました")})}}),void 0===AFRAME.components.log&&AFRAME.registerComponent("log",{schema:{type:"string"},init(){let e=this.data;console.log("log内容",e)}})},[b]);let calculateDistance=(e,t,n,o)=>{let l=(n-e)*Math.PI/180,a=(o-t)*Math.PI/180,r=Math.sin(l/2)*Math.sin(l/2)+Math.cos(e*Math.PI/180)*Math.cos(n*Math.PI/180)*Math.sin(a/2)*Math.sin(a/2);return 6371e3*(2*Math.atan2(Math.sqrt(r),Math.sqrt(1-r)))},[_,m]=(0,i.useState)([]);return(0,i.useEffect)(()=>{let updateVisiblePosts=()=>{var e;let n=t.latitude,o=t.longitude;if(null===n||null===o)return;let l=null!==(e=null==a?void 0:a.filter(e=>{let t=calculateDistance(n,o,e.latitude,e.longitude);return t<1e3}))&&void 0!==e?e:[];m(l)},e=navigator.geolocation.watchPosition(()=>{updateVisiblePosts()});return()=>navigator.geolocation.clearWatch(e)},[a,t.latitude,t.longitude]),(0,o.jsxs)("div",{children:[(0,o.jsx)(r(),{href:"/",children:(0,o.jsx)("button",{className:f().mapButton,children:"MAP"})}),null!==t.latitude&&null!==t.longitude&&(0,o.jsxs)("div",{className:f().coordinatesInfo,children:["Latitude: ",t.latitude,", Longitude: ",t.longitude]}),(0,o.jsxs)("a-scene",{"vr-mode-ui":"enabled: false",arjs:"sourceType: webcam; videoTexture: true; debugUIEnabled: false",renderer:"antialias: true; alpha: true",children:[null==_?void 0:_.map((e,t)=>(0,o.jsxs)("a-entity",{id:"post".concat(t),position:"".concat(2*t," 1 -1"),rotation:"0 0 0",children:[(0,o.jsx)("a-plane",{color:"#a4bbe5",height:"1",width:"1.5",position:"0 0 -0.1"}),(0,o.jsx)("a-text",{value:e.content,position:"0 0.2 0","gps-new-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.4 0.4 0.4",color:"black",align:"center"}),(0,o.jsx)("a-entity",{position:"-0.4 -0.2 0","gps-new-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),"gltf-model":"/models/love_heart.gltf",scale:"0.0005 0.0005 0.0005"}),(0,o.jsx)("a-entity",{position:"-0.4, -0.15 0","data-post-id":e.id,"hit-box":!0,children:(0,o.jsx)("a-entity",{class:"raycastable","gps-new-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.1 0.2 0.1",position:"0 0 0",visible:"false"})}),(0,o.jsx)("a-text",{value:"Likes: ".concat(e.likeCount),position:"0.3 -0.2 0","gps-new-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.2 0.2 0.2",color:"black"})]},t)),(0,o.jsx)("a-camera",{"gps-new-camera":"maxDistance:20","rotation-reader":!0}),(0,o.jsx)("a-entity",{id:"mouseCursor",cursor:"rayOrigin: mouse",raycaster:"objects: .raycastable"})]})]})},index_page=()=>(0,o.jsx)("div",{children:(0,o.jsx)(ar_page,{})})},5123:function(e){e.exports={mapButton:"ar_mapButton__k_EPZ",coordinatesInfo:"ar_coordinatesInfo__1KWgl"}},1664:function(e,t,n){e.exports=n(5170)}},function(e){e.O(0,[774,888,179],function(){return e(e.s=4747)}),_N_E=e.O()}]);