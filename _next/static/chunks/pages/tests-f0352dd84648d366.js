(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[155],{3555:function(e,s,t){(window.__NEXT_P=window.__NEXT_P||[]).push(["/tests",function(){return t(2418)}])},3936:function(e,s,t){"use strict";t.d(s,{v:function(){return BasicHeader}});var n=t(5893),i=t(8583),a=t(1163),l=t(6221);let HumanIcon=e=>(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:e.size,height:e.size,fill:e.fill,children:(0,n.jsx)("path",{d:"M12 0c-6.627 0-12 5.373-12 12s5.373 12 12 12 12-5.373 12-12-5.373-12-12-12zm7.753 18.305c-.261-.586-.789-.991-1.871-1.241-2.293-.529-4.428-.993-3.393-2.945 3.145-5.942.833-9.119-2.489-9.119-3.388 0-5.644 3.299-2.489 9.119 1.066 1.964-1.148 2.427-3.393 2.945-1.084.25-1.608.658-1.867 1.246-1.405-1.723-2.251-3.919-2.251-6.31 0-5.514 4.486-10 10-10s10 4.486 10 10c0 2.389-.845 4.583-2.247 6.305z"})});var r=t(4076),o=t(5293),d=t.n(o);let BasicHeader=e=>{let{user:s}=e,onLogout=async()=>{confirm("Logout?")&&await (0,r.kS)()},t=(0,a.useRouter)(),[o,c]=(0,i.KO)(l.XI),handleChenge=async()=>{o?await t.push("/"):await t.push("/AR"),c(!o)};return(0,n.jsx)("div",{className:d().container,children:(0,n.jsxs)("div",{className:d().main,children:[(0,n.jsx)("h3",{children:"ArMapSNS"}),(0,n.jsxs)("div",{className:d().userBtn,onClick:onLogout,children:[void 0!==s.photoURL?(0,n.jsx)("img",{className:d().userIcon,src:s.photoURL,height:24,alt:s.displayName}):(0,n.jsx)(HumanIcon,{size:18,fill:"#555"}),(0,n.jsx)("span",{className:d().userName,children:s.displayName})]}),(0,n.jsx)("button",{onClick:handleChenge,children:"MAP or AR"})]})})}},2418:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return index_page}});var n=t(5893),i=t(7462),a=t(3366),l=t(7294),r=t(512),o=t(9731),d=t(6523),c=t(9766),u=t(4920);let h=["sx"],splitProps=e=>{var s,t;let n={systemProps:{},otherProps:{}},i=null!=(s=null==e||null==(t=e.theme)?void 0:t.unstable_sxConfig)?s:u.Z;return Object.keys(e).forEach(s=>{i[s]?n.systemProps[s]=e[s]:n.otherProps[s]=e[s]}),n};var x=t(9718);let p=["className","component"];var g=t(7078),j=t(1265),m=t(606);let f=(0,j.Z)(),w=function(e={}){let{themeId:s,defaultTheme:t,defaultClassName:u="MuiBox-root",generateClassName:g}=e,j=(0,o.ZP)("div",{shouldForwardProp:e=>"theme"!==e&&"sx"!==e&&"as"!==e})(d.Z),m=l.forwardRef(function(e,l){let o=(0,x.Z)(t),d=function(e){let s;let{sx:t}=e,n=(0,a.Z)(e,h),{systemProps:l,otherProps:r}=splitProps(n);return s=Array.isArray(t)?[l,...t]:"function"==typeof t?(...e)=>{let s=t(...e);return(0,c.P)(s)?(0,i.Z)({},l,s):l}:(0,i.Z)({},l,t),(0,i.Z)({},r,{sx:s})}(e),{className:m,component:f="div"}=d,w=(0,a.Z)(d,p);return(0,n.jsx)(j,(0,i.Z)({as:f,ref:l,className:(0,r.Z)(m,g?g(u):u),theme:s&&o[s]||o},w))});return m}({themeId:m.Z,defaultTheme:f,defaultClassName:"MuiBox-root",generateClassName:g.Z.generate});var v=t(8993),y=t(2244),_=t(8583),k=t(6221),N=t(9854),C=t(3936),P=t(3483),Z=t(6819),index_page=()=>{let[e]=(0,_.KO)(k.LF),[s,t]=(0,_.KO)(k.ge);(0,l.useEffect)(()=>{"undefined"!=typeof navigator&&null!==navigator.geolocation&&navigator.geolocation.watchPosition(e=>{t({latitude:e.coords.latitude,longitude:e.coords.longitude})})},[t,e]);let[i,a]=(0,l.useState)(null),[r,o]=(0,l.useState)(""),d=(0,l.useCallback)(async()=>{if((null==e?void 0:e.id)===void 0)return;let s=await P.x.myPost.$get({query:{userID:null==e?void 0:e.id}}).catch(Z.F);a(s)},[null==e?void 0:e.id]),[c,u]=(0,l.useState)(null),h=(0,l.useCallback)(async()=>{let e=await P.x.posts.$get().catch(Z.F);u(e)},[]),postPostContent=async()=>{if((null==e?void 0:e.id)===void 0||""===r||null===s.latitude||null===s.longitude)return;let t=s.latitude,n=s.longitude,i=await P.x.myPost.$post({body:{username:"Hotaka",content:r,latitude:t,longitude:n,userID:e.id}});o(""),await d(),console.log("result",i)},deletePostContent=async e=>{await P.x.myPost.$delete({query:{postID:e}}).catch(Z.F),await d()},handleLike=async e=>{await P.x.posts.$patch({body:{postID:e,increment:!0}}),await h()},[x,p]=(0,l.useState)(null);return((0,l.useEffect)(()=>{d(),h()},[d,h,e]),e)?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(C.v,{user:e}),(0,n.jsxs)("div",{style:{display:"flex"},children:[(0,n.jsxs)(w,{sx:{padding:2,paddingLeft:10},children:[(0,n.jsx)("h1",{children:"自分の投稿"}),(0,n.jsx)(y.Z,{label:"投稿内容",value:r,onChange:e=>o(e.target.value),InputProps:{endAdornment:(0,n.jsx)(v.Z,{onClick:postPostContent,disabled:!r.trim(),children:"投稿する"})}}),(0,n.jsx)(w,{sx:{paddingTop:2},children:i&&i.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(v.Z,{onClick:()=>deletePostContent(e.id),children:"Delete Post"}),(0,n.jsx)("p",{children:e.postTime}),(0,n.jsxs)("h4",{children:["Content: ",e.content]}),(0,n.jsxs)("p",{children:["latitude: ",e.latitude]}),(0,n.jsxs)("p",{children:["longitude: ",e.longitude]}),(0,n.jsxs)("p",{children:["likes: ",e.likes]}),(0,n.jsx)("br",{})]},e.id))})]}),(0,n.jsxs)(w,{sx:{padding:2,paddingLeft:10},children:[(0,n.jsx)("h1",{children:"24時間以内内容"}),(0,n.jsx)(w,{sx:{paddingTop:2},children:c&&c.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(v.Z,{onClick:()=>handleLike(e.id),children:"いいね"}),(0,n.jsxs)("h3",{children:["user: ",e.userName]}),(0,n.jsxs)("p",{children:["Content: ",e.content]}),(0,n.jsxs)("p",{children:["Time: ",e.postTime]}),(0,n.jsxs)("p",{children:["likes: ",e.likes]}),(0,n.jsx)("br",{})]},e.id))})]}),(0,n.jsxs)(w,{sx:{padding:2,paddingLeft:10},children:[(0,n.jsx)("h1",{children:"半径1km以内の内容"}),(0,n.jsx)(w,{sx:{paddingTop:2},children:c&&c.map(e=>(0,n.jsxs)("div",{children:[(0,n.jsx)(v.Z,{onClick:()=>handleLike(e.id),children:"いいね"}),(0,n.jsxs)("h3",{children:["userName: ",e.userName]}),(0,n.jsxs)("p",{children:["id:",e.id]}),(0,n.jsxs)("p",{children:["userID:",e.userID]}),(0,n.jsxs)("p",{children:["Content: ",e.content]}),(0,n.jsxs)("p",{children:["Time: ",e.postTime]}),(0,n.jsxs)("p",{children:["latitude: ",e.latitude]}),(0,n.jsxs)("p",{children:["longitude: ",e.longitude]}),(0,n.jsxs)("p",{children:["likes: ",e.likes]}),(0,n.jsx)("br",{})]},e.id))})]})]})]}):(0,n.jsx)(N.g,{visible:!0})}},4076:function(e,s,t){"use strict";t.d(s,{id:function(){return authWithEmail},kS:function(){return logout}});var n=t(4857),i=t(2509),a=t(3483),l=t(6819);let logout=async()=>{await (0,i.l)().signOut()},checkIfNewUser=async e=>{let s=await a.x.user.$get({query:{userID:e}});0===s.length&&await a.x.user.post({body:{userID:e}}).catch(l.F)},authWithEmail=async(e,s)=>{let t=(0,i.l)();try{let i=await (0,n.e5)(t,e,s),a=i.user.uid;await checkIfNewUser(a),console.log("ログイン成功")}catch(i){if("auth/user-not-found"!==i.code)return console.error("ログイン失敗",i),null;try{let i=await (0,n.Xb)(t,e,s),a=i.user.uid;await checkIfNewUser(a),console.log("新規登録成功")}catch(e){return console.log("新規登録失敗",e),null}}}},5293:function(e){e.exports={container:"BasicHeader_container__ASIaK",main:"BasicHeader_main__Vqufr",userBtn:"BasicHeader_userBtn__wlK48",userIcon:"BasicHeader_userIcon__UecGa",userName:"BasicHeader_userName__KiR1h"}}},function(e){e.O(0,[125,774,888,179],function(){return e(e.s=3555)}),_N_E=e.O()}]);