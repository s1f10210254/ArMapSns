(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4747:function(t,e,o){(window.__NEXT_P=window.__NEXT_P||[]).push(["/AR",function(){return o(7892)}])},7892:function(t,e,o){"use strict";o.r(e),o.d(e,{default:function(){return index_page}});var n=o(5893),a=o(8583),i=o(1664),l=o.n(i),s=o(7294),c=o(6221),u=o(3483),r=o(6819),d=o(5123),g=o.n(d),ar_page=()=>{let[t]=(0,a.KO)(c.LF),[e,o]=(0,a.KO)(c.ge),[i,d]=(0,s.useState)(null),p=(0,s.useCallback)(async()=>{if(null===e.latitude||null===e.longitude)return;let t=e.latitude,o=e.longitude,n=await u.x.posts.$get({query:{latitude:t,longitude:o}}).catch(r.F);d(n),console.log("getPosts")},[e.latitude,e.longitude]);(0,s.useEffect)(()=>{"undefined"!=typeof navigator&&null!==navigator.geolocation&&navigator.geolocation.watchPosition(t=>{o({latitude:t.coords.latitude,longitude:t.coords.longitude})})},[o]);let[f,m]=(0,s.useState)(!0);(0,s.useEffect)(()=>{if(f&&null!==e.latitude&&null!==e.longitude){let oneRendaringGetPosts=async()=>{let t=e.latitude,o=e.longitude,n=await u.x.posts.$get({query:{latitude:t,longitude:o}}).catch(r.F);d(n)};oneRendaringGetPosts(),m(!1)}},[e.latitude,e.longitude,f]);let[h,x]=(0,s.useState)(0);window.handleLike=async e=>{if((null==t?void 0:t.id)===void 0||void 0===e)return;let o=await u.x.posts.$post({body:{postId:e,userId:t.id}});console.log("result",o),x(o),await p(),console.log("result",o),console.log("likecount",h)},(0,s.useEffect)(()=>{void 0===AFRAME.components["hit-box"]&&AFRAME.registerComponent("hit-box",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let t=this.data.postId;console.log("postID",t),window.handleLike(t)})}}),void 0===AFRAME.components.log&&AFRAME.registerComponent("log",{schema:{type:"string"},init(){let t=this.data;console.log("log内容",t)}})},[]);let formatTime=t=>{let e=new Date(t);return new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(e)},formatContent=t=>{let e="";for(let o=0;o<t.length;o+=12){let n=t.substring(o,o+12);e+=n+(o+12<t.length?"\n":"")}return e},y=null==i?void 0:i.length,xValue=t=>{if(void 0!==y)return 5*Math.cos(t/y*Math.PI*2)},yValue=()=>{if(void 0!==y)return 0},zValue=t=>{if(void 0!==y)return 5*Math.sin(t/y*Math.PI*2)};return(0,n.jsxs)("div",{children:[(0,n.jsx)(l(),{href:"/",children:(0,n.jsx)("button",{className:g().mapButton,children:"MAPに戻る"})}),(0,n.jsxs)("a-scene",{"vr-mode-ui":"enabled: false",arjs:"sourceType: webcam; videoTexture: true; debugUIEnabled: false",renderer:"antialias: true; alpha: true",children:[null==i?void 0:i.map((e,o)=>(0,n.jsxs)("a-entity",{id:"post".concat(o),position:"".concat(xValue(o)," ").concat(yValue()," ").concat(zValue(o)),rotation:"0 0 0","look-at":"[camera]",scale:"3 3 3",children:[e.userID===(null==t?void 0:t.id)?(0,n.jsx)("a-box",{color:"#c2c7ee",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}):(0,n.jsx)("a-box",{color:"#f6a985",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}),(0,n.jsx)("a-plane",{color:"#fffbfb",height:"0.5",width:"1",position:"0 0.2 0",align:"center"}),(0,n.jsx)("a-text",{value:formatContent(e.content),font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png",position:"0 0.2 0.001","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.4 0.4 0.4",color:"#000000",align:"center",negate:"false"}),(0,n.jsx)("a-entity",{position:"-0.4 -0.3 0","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),"gltf-model":"/models/love_heart.gltf",scale:"0.0008 0.0007 0.0005"}),(0,n.jsx)("a-entity",{position:"-0.4, -0.225 0","hit-box":"postId: ".concat(e.id),children:(0,n.jsx)("a-entity",{class:"raycastable","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.2 0.2 0.1",position:"0 0 0",visible:"false"})}),(0,n.jsx)("a-text",{value:"Likes: ".concat(e.likeCount),position:"-0.48 -0.1 0","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.2 0.2 0.2",color:"black"}),(0,n.jsx)("a-text",{value:"".concat(formatTime(e.postTime)),position:"0.1 -0.3 0",font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.25 0.25 0.25",color:"#413f3f",negate:"false"})]},o)),(0,n.jsx)("a-camera",{"gps-camera":!0,"rotation-reader":!0}),(0,n.jsx)("a-entity",{id:"mouseCursor",cursor:"rayOrigin: mouse",raycaster:"objects: .raycastable"})]})]})},index_page=()=>(0,n.jsx)("div",{children:(0,n.jsx)(ar_page,{})})},5123:function(t){t.exports={mapButton:"ar_mapButton__k_EPZ",coordinatesInfo:"ar_coordinatesInfo__1KWgl"}}},function(t){t.O(0,[664,774,888,179],function(){return t(t.s=4747)}),_N_E=t.O()}]);