(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4747:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/AR",function(){return n(7892)}])},6221:function(t,e,n){"use strict";n.d(e,{LF:function(){return a},ge:function(){return s}});var o=n(5103);let a=(0,o.cn)(null),s=(0,o.cn)({latitude:null,longitude:null});(0,o.cn)(!0)},9854:function(t,e,n){"use strict";n.d(e,{g:function(){return Loading}});var o=n(5893),a=n(7294),s=n(3935);let Portal=t=>{let{children:e}=t,[n,o]=(0,a.useState)();return(0,a.useEffect)(()=>{let t=document.createElement("div");return document.body.appendChild(t),o(t),()=>{document.body.removeChild(t)}},[]),n?s.createPortal(e,n):null};var i=n(8046),l=n.n(i);let Loading=t=>t.visible?(0,o.jsx)(Portal,{children:(0,o.jsx)("div",{className:l().container,children:(0,o.jsx)("div",{className:l().loader})})}):null},7892:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return index_page}});var o=n(5893),a=n(8583),s=n(1664),i=n.n(s),l=n(1163),c=n(7294),d=n(6221),r=n(9854),u=n(5066),p=n(2745),g=n(6819),h=n(5123),y=n.n(h),ar_page=()=>{let[t,e]=(0,a.KO)(d.LF),[n,s]=(0,a.KO)(d.ge),[h,m]=(0,c.useState)(null),f=(0,l.useRouter)();(0,c.useEffect)(()=>{let t=localStorage.getItem("user");if(null!==t){let n=JSON.parse(t);e(n)}else f.push("/login")},[e,f]);let j=(0,c.useCallback)(async()=>{if(null===n.latitude||null===n.longitude)return;let t=n.latitude,e=n.longitude,o=await u.x.posts.$get({query:{latitude:t,longitude:e}}).catch(g.F);m(o),console.log("getPosts")},[n.latitude,n.longitude]);(0,c.useEffect)(()=>{"undefined"!=typeof navigator&&null!==navigator.geolocation&&navigator.geolocation.watchPosition(t=>{s({latitude:t.coords.latitude,longitude:t.coords.longitude})})},[s]);let[x,b]=(0,c.useState)(!0);(0,c.useEffect)(()=>{if(x&&null!==n.latitude&&null!==n.longitude){let oneRendaringGetPosts=async()=>{let t=n.latitude,e=n.longitude,o=await u.x.posts.$get({query:{latitude:t,longitude:e}}).catch(g.F);m(o)};oneRendaringGetPosts(),b(!1)}},[n.latitude,n.longitude,x]);let[E,v]=(0,c.useState)(0),[$,_]=(0,c.useState)(!1);window.handleLike=async e=>{if((null==t?void 0:t.id)===void 0||void 0===e)return;let n=await u.x.posts.$post({body:{postId:e,userId:t.id}});console.log("result",n),v(n),_(!$),await j(),console.log("result",n),console.log("likecount",E)},window.deletePostContent=async t=>{console.log("postID",t),await u.x.myPost.$delete({query:{postID:t}}).catch(g.F),await j()},(0,c.useEffect)(()=>{void 0===AFRAME.components.likes&&AFRAME.registerComponent("likes",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let t=this.data.postId;console.log("postID",t),window.handleLike(t)})}}),void 0===AFRAME.components.delete&&AFRAME.registerComponent("delete",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let t=this.data.postId;confirm("削除しますか？")&&window.deletePostContent(t)})}}),void 0===AFRAME.components.log&&AFRAME.registerComponent("log",{schema:{type:"string"},init(){let t=this.data;console.log("log内容",t)}})},[]);let T=null==h?void 0:h.length,xValue=t=>void 0===T?0:-5*Math.cos(t/T*Math.PI*2),yValue=()=>0,zValue=t=>void 0===T?0:-5*Math.sin(t/T*Math.PI*2);return t?(0,o.jsxs)("div",{children:[(0,o.jsx)(i(),{href:"/",children:(0,o.jsx)("button",{className:y().mapButton,children:"MAPに戻る"})}),(0,o.jsxs)("a-scene",{"vr-mode-ui":"enabled: false",arjs:"sourceType: webcam; videoTexture: true; debugUIEnabled: false",renderer:"antialias: true; alpha: true",children:[(0,o.jsxs)("a-assets",{children:[(0,o.jsx)("img",{id:"delete",src:"/icons/delete.png"}),(0,o.jsx)("img",{id:"heart",src:"/icons/likes.png"})]}),null==h?void 0:h.map((e,n)=>(0,o.jsxs)("a-entity",{id:"post".concat(n),position:"".concat(xValue(n)," ").concat(yValue()," ").concat(zValue(n)),rotation:"0 0 0","look-at":"[camera]",scale:"3 3 3",animation:"property: scale; to: 2.8 2.8 2.8; dir: alternate; dur: 2000; loop: true",children:[e.userID===(null==t?void 0:t.id)?(0,o.jsx)("a-box",{color:"#c2c7ee",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}):(0,o.jsx)("a-box",{color:"#f6a985",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}),(0,o.jsx)("a-plane",{color:"#fffbfb",height:"0.9",width:"1.4",position:"0 0 0",align:"center"}),(0,o.jsx)("a-text",{value:(0,p.N)(e.content),font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png",position:"-0.65 0.2 0.001","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.4 0.4 0.4",color:"#000000",negate:"false"}),$?(0,o.jsx)("a-plane",{material:"src : #heart ;transparent: true; color:red;",position:"-0.4 -0.3 0.09",scale:"0.2 0.2 0.2","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude)}):(0,o.jsx)("a-plane",{material:"src : #heart ;transparent: true; color:white;",position:"-0.4 -0.3 0.09",scale:"0.2 0.2 0.2","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude)}),(0,o.jsx)("a-entity",{position:"-0.4, -0.3 0.1",likes:"postId: ".concat(e.id),children:(0,o.jsx)("a-entity",{class:"raycastable","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.2 0.2 0.1",position:"0 0 0",visible:"false"})}),(0,o.jsx)("a-text",{value:"Likes: ".concat(e.likeCount),position:"-0.5 -0.2 0.1","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.2 0.2 0.2",color:"black"}),(0,o.jsx)("a-text",{value:"".concat((0,p.m)(e.postTime)),position:"0.01 -0.4 0",font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.25 0.25 0.25",color:"#413f3f",negate:"false"}),(null==t?void 0:t.id)===e.userID&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("a-plane",{material:"src : #delete ;transparent: true;",position:"0.3 -0.25 0.1",scale:"0.1 0.1 0.1","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude)}),(0,o.jsx)("a-entity",{position:"0.3, -0.25 0.1",delete:"postId: ".concat(e.id),children:(0,o.jsx)("a-entity",{class:"raycastable","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.2 0.2 0.1",position:"0 0 0",visible:"false"})})]})]},n)),(0,o.jsx)("a-camera",{"gps-camera":!0,"rotation-reader":!0}),(0,o.jsx)("a-light",{type:"ambient",color:"#FFFFFF"}),(0,o.jsx)("a-entity",{id:"mouseCursor",cursor:"rayOrigin: mouse",raycaster:"objects: .raycastable"})]})]}):(0,o.jsx)("div",{children:(0,o.jsx)(r.g,{visible:!0})})},index_page=()=>(0,o.jsx)("div",{children:(0,o.jsx)(ar_page,{})})},5066:function(t,e,n){"use strict";n.d(e,{x:function(){return i}});var o=n(9239),a=n(7080),s=n(6154);let i=(t=>{let{baseURL:e,fetch:n}=t,o=(void 0===e?"":e).replace(/\/$/,""),s="/health",i="/likes",l="/myPost",c="/posts",d="/session",r="/tasks",u="/tasks/di",p="/test",g="/user",h="POST",y="DELETE",m="PATCH";return{health:{get:t=>n(o,s,"GET",t).json(),$get:t=>n(o,s,"GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat(s)},likes:{get:t=>n(o,i,"GET",t).json(),$get:t=>n(o,i,"GET",t).json().then(t=>t.body),post:t=>n(o,i,h,t).json(),$post:t=>n(o,i,h,t).json().then(t=>t.body),patch:t=>n(o,i,m,t).json(),$patch:t=>n(o,i,m,t).json().then(t=>t.body),delete:t=>n(o,i,y,t).text(),$delete:t=>n(o,i,y,t).text().then(t=>t.body),$path:t=>"".concat(o).concat(i).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},me:{get:t=>n(o,"/me","GET",t).json(),$get:t=>n(o,"/me","GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat("/me")},myPost:{get:t=>n(o,l,"GET",t).json(),$get:t=>n(o,l,"GET",t).json().then(t=>t.body),post:t=>n(o,l,h,t).send(),$post:t=>n(o,l,h,t).send().then(t=>t.body),delete:t=>n(o,l,y,t).send(),$delete:t=>n(o,l,y,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(l).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},posts:{get:t=>n(o,c,"GET",t).json(),$get:t=>n(o,c,"GET",t).json().then(t=>t.body),post:t=>n(o,c,h,t).send(),$post:t=>n(o,c,h,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(c).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},session:{post:t=>n(o,d,h,t).json(),$post:t=>n(o,d,h,t).json().then(t=>t.body),delete:t=>n(o,d,y,t).json(),$delete:t=>n(o,d,y,t).json().then(t=>t.body),$path:()=>"".concat(o).concat(d)},tasks:{_taskId:t=>{let e="".concat(r,"/").concat(t);return{patch:t=>n(o,e,m,t).json(),$patch:t=>n(o,e,m,t).json().then(t=>t.body),delete:t=>n(o,e,y,t).json(),$delete:t=>n(o,e,y,t).json().then(t=>t.body),$path:()=>"".concat(o).concat(e)}},di:{get:t=>n(o,u,"GET",t).json(),$get:t=>n(o,u,"GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat(u)},get:t=>n(o,r,"GET",t).json(),$get:t=>n(o,r,"GET",t).json().then(t=>t.body),post:t=>n(o,r,h,t).json(),$post:t=>n(o,r,h,t).json().then(t=>t.body),patch:t=>n(o,r,m,t).json(),$patch:t=>n(o,r,m,t).json().then(t=>t.body),delete:t=>n(o,r,y,t).json(),$delete:t=>n(o,r,y,t).json().then(t=>t.body),$path:t=>"".concat(o).concat(r).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},test:{get:t=>n(o,p,"GET",t).text(),$get:t=>n(o,p,"GET",t).text().then(t=>t.body),$path:()=>"".concat(o).concat(p)},user:{get:t=>n(o,g,"GET",t).json(),$get:t=>n(o,g,"GET",t).json().then(t=>t.body),post:t=>n(o,g,h,t).send(),$post:t=>n(o,g,h,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(g).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},get:t=>n(o,"","GET",t).text(),$get:t=>n(o,"","GET",t).text().then(t=>t.body),$path:()=>"".concat(o)}})((0,o.Z)(s.Z.create({withCredentials:!0})))},2745:function(t,e,n){"use strict";n.d(e,{N:function(){return formatContent},m:function(){return formatTime}});let formatTime=t=>{let e=new Date(t);return new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(e)},formatContent=t=>{let e="";for(let n=0;n<t.length;n+=17){let o=t.substring(n,n+17);e+=o+(n+17<t.length?"\n":"")}return e}},6819:function(t,e,n){"use strict";n.d(e,{F:function(){return returnNull}});let returnNull=()=>null},5123:function(t){t.exports={mapButton:"ar_mapButton__k_EPZ",coordinatesInfo:"ar_coordinatesInfo__1KWgl"}},8046:function(t){t.exports={container:"Loading_container__wV1ri",loader:"Loading_loader__cpdbt",load:"Loading_load__8NQtO"}}},function(t){t.O(0,[583,911,664,774,888,179],function(){return t(t.s=4747)}),_N_E=t.O()}]);