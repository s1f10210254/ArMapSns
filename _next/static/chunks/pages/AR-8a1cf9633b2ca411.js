(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[221],{4747:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/AR",function(){return n(3795)}])},6221:function(t,e,n){"use strict";n.d(e,{LF:function(){return a},ge:function(){return s}});var o=n(5103);let a=(0,o.cn)(null),s=(0,o.cn)({latitude:null,longitude:null});(0,o.cn)(!0)},9854:function(t,e,n){"use strict";n.d(e,{g:function(){return Loading}});var o=n(5893),a=n(7294),s=n(3935);let Portal=t=>{let{children:e}=t,[n,o]=(0,a.useState)();return(0,a.useEffect)(()=>{let t=document.createElement("div");return document.body.appendChild(t),o(t),()=>{document.body.removeChild(t)}},[]),n?s.createPortal(e,n):null};var i=n(8046),c=n.n(i);let Loading=t=>t.visible?(0,o.jsx)(Portal,{children:(0,o.jsx)("div",{className:c().container,children:(0,o.jsx)("div",{className:c().loader})})}):null},9579:function(t,e,n){"use strict";var o=n(8583),a=n(1163),s=n(7294),i=n(6221);e.Z=()=>{let[t,e]=(0,o.KO)(i.LF),n=(0,a.useRouter)();return(0,s.useEffect)(()=>{let t=localStorage.getItem("user");if(null!==t){let n=JSON.parse(t);e(n)}else n.push("/login")},[e,n]),t}},9588:function(t,e,n){"use strict";var o=n(8583),a=n(7294),s=n(6221);e.Z=()=>{let[t,e]=(0,o.KO)(s.ge);return(0,a.useEffect)(()=>{"undefined"!=typeof navigator&&null!==navigator.geolocation&&navigator.geolocation.watchPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude})})}),t}},3795:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return index_page}});var o=n(5893),a=n(1664),s=n.n(a),i=n(7294),c=n(9854),l=n(9579),r=n(9588),d=n(5066);let xValue=(t,e)=>void 0===e?0:-5*Math.cos(t/e*Math.PI*2),yValue=()=>0,zValue=(t,e)=>void 0===e?0:-5*Math.sin(t/e*Math.PI*2);var u=n(2745),p=n(6819),h=n(5123),g=n.n(h),ar_page=()=>{let[t,e]=(0,i.useState)(null),[n,a]=(0,i.useState)({}),[h,y]=(0,i.useState)(!0),m=(0,l.Z)(),f=(0,r.Z)(),j=(0,i.useCallback)(async()=>{if(null===f.latitude||null===f.longitude)return;let t=f.latitude,n=f.longitude,o=await d.x.posts.$get({query:{latitude:t,longitude:n}}).catch(p.F);e(o)},[f.latitude,f.longitude]),b=(0,i.useCallback)(async t=>{if(null===m)return;let e=await d.x.likes.$get({query:{postId:t,userId:m.id}});return e},[m]),x=(0,i.useCallback)(async t=>{let e={};for(let n of t){let t=await b(n.id);e[n.id]=void 0!==t&&t}a(e)},[b]);(0,i.useEffect)(()=>{h&&null!==f.latitude&&null!==f.longitude&&j().then(()=>{t&&(x(t),y(!1))})},[h,f,j,t,x]);let $=(0,i.useCallback)(async t=>{if((null==m?void 0:m.id)===void 0||void 0===t)return;let n=await d.x.likes.$patch({body:{postId:t,userId:m.id}});a(e=>({...e,[t]:!e[t]})),e(e=>e?e.map(e=>e.id===t?{...e,likeCount:n}:e):e)},[null==m?void 0:m.id]),v=(0,i.useCallback)(async t=>{await d.x.likes.$delete({body:{postId:t}}).catch(p.F),await d.x.myPost.$delete({query:{postID:t}}).catch(p.F),await j()},[j]);return((0,i.useEffect)(()=>{void 0===AFRAME.components.likes&&AFRAME.registerComponent("likes",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let t=this.data.postId;$(t)})}}),void 0===AFRAME.components.delete&&AFRAME.registerComponent("delete",{schema:{postId:{type:"string"}},init(){this.el.addEventListener("click",()=>{let t=this.data.postId;confirm("削除しますか？")&&v(t)})}})},[v,$]),m)?(0,o.jsxs)("div",{children:[(0,o.jsx)(s(),{href:"/",children:(0,o.jsx)("button",{className:g().mapButton,children:"MAPに戻る"})}),(0,o.jsxs)("a-scene",{"vr-mode-ui":"enabled: false",arjs:"sourceType: webcam; videoTexture: true; debugUIEnabled: false",renderer:"antialias: true; alpha: true",children:[(0,o.jsxs)("a-assets",{children:[(0,o.jsx)("img",{id:"delete",src:"/icons/delete.png"}),(0,o.jsx)("img",{id:"heart",src:"/icons/likes.png"})]}),null==t?void 0:t.map((e,a)=>(0,o.jsxs)("a-entity",{id:"post".concat(a),position:"".concat(xValue(a,t.length)," ").concat(yValue()," ").concat(zValue(a,t.length)),rotation:"0 0 0","look-at":"[camera]",scale:"3 3 3",animation:"property: scale; to: 2.8 2.8 2.8; dir: alternate; dur: 2000; loop: true",children:[e.userID===(null==m?void 0:m.id)?(0,o.jsx)("a-box",{color:"#c2c7ee",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}):(0,o.jsx)("a-box",{color:"#f6a985",height:"1",width:"1.5",depth:"0.1",position:"0 0 -0.1"}),(0,o.jsx)("a-plane",{color:"#fffbfb",height:"0.9",width:"1.4",position:"0 0 0",align:"center"}),(0,o.jsx)("a-text",{value:(0,u.N)(e.content),font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png",position:"-0.65 0.2 0.001","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.4 0.4 0.4",color:"#000000",negate:"false"}),(0,o.jsx)("a-plane",{material:"src: #heart; transparent: true; color: ".concat(n[e.id]?"red":"white",";"),position:"-0.4 -0.3 0.09",scale:"0.2 0.2 0.2","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude)}),(0,o.jsx)("a-entity",{position:"-0.4, -0.3 0.1",likes:"postId: ".concat(e.id),children:(0,o.jsx)("a-entity",{class:"raycastable","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.2 0.2 0.1",position:"0 0 0",visible:"false"})}),(0,o.jsx)("a-text",{value:"Likes: ".concat(e.likeCount),position:"-0.5 -0.2 0.1","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.2 0.2 0.2",color:"black"}),(0,o.jsx)("a-text",{value:"".concat((0,u.m)(e.postTime)),position:"0.01 -0.4 0",font:"/fonts/mplus-msdf.json","font-image":"/png/mplus-msdf.png","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),scale:"0.25 0.25 0.25",color:"#413f3f",negate:"false"}),(null==m?void 0:m.id)===e.userID&&(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("a-plane",{material:"src : #delete ;transparent: true;",position:"0.3 -0.25 0.1",scale:"0.1 0.1 0.1","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude)}),(0,o.jsx)("a-entity",{position:"0.3, -0.25 0.1",delete:"postId: ".concat(e.id),children:(0,o.jsx)("a-entity",{class:"raycastable","gps-entity-place":"latitude: ".concat(e.latitude,"; longitude: ").concat(e.longitude),geometry:"primitive:box",material:"color:blue; opacity: 0.5",scale:"0.2 0.2 0.1",position:"0 0 0",visible:"false"})})]})]},a)),(0,o.jsx)("a-camera",{"gps-camera":!0,"rotation-reader":!0}),(0,o.jsx)("a-light",{type:"ambient",color:"#FFFFFF"}),(0,o.jsx)("a-entity",{id:"mouseCursor",cursor:"rayOrigin: mouse",raycaster:"objects: .raycastable"})]})]}):(0,o.jsx)("div",{children:(0,o.jsx)(c.g,{visible:!0})})},index_page=()=>(0,o.jsx)("div",{children:(0,o.jsx)(ar_page,{})})},5066:function(t,e,n){"use strict";n.d(e,{x:function(){return i}});var o=n(9239),a=n(7080),s=n(6154);let i=(t=>{let{baseURL:e,fetch:n}=t,o=(void 0===e?"":e).replace(/\/$/,""),s="/health",i="/likes",c="/minio",l="/myPost",r="/posts",d="/session",u="/tasks",p="/tasks/di",h="/test",g="/user",y="POST",m="DELETE",f="PATCH";return{health:{get:t=>n(o,s,"GET",t).json(),$get:t=>n(o,s,"GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat(s)},likes:{get:t=>n(o,i,"GET",t).json(),$get:t=>n(o,i,"GET",t).json().then(t=>t.body),post:t=>n(o,i,y,t).json(),$post:t=>n(o,i,y,t).json().then(t=>t.body),patch:t=>n(o,i,f,t).json(),$patch:t=>n(o,i,f,t).json().then(t=>t.body),delete:t=>n(o,i,m,t).text(),$delete:t=>n(o,i,m,t).text().then(t=>t.body),$path:t=>"".concat(o).concat(i).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},me:{get:t=>n(o,"/me","GET",t).json(),$get:t=>n(o,"/me","GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat("/me")},minio:{get:t=>n(o,c,"GET",t).json(),$get:t=>n(o,c,"GET",t).json().then(t=>t.body),post:t=>n(o,c,y,t,"FormData").json(),$post:t=>n(o,c,y,t,"FormData").json().then(t=>t.body),$path:()=>"".concat(o).concat(c)},myPost:{get:t=>n(o,l,"GET",t).json(),$get:t=>n(o,l,"GET",t).json().then(t=>t.body),post:t=>n(o,l,y,t).send(),$post:t=>n(o,l,y,t).send().then(t=>t.body),delete:t=>n(o,l,m,t).send(),$delete:t=>n(o,l,m,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(l).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},posts:{get:t=>n(o,r,"GET",t).json(),$get:t=>n(o,r,"GET",t).json().then(t=>t.body),post:t=>n(o,r,y,t).send(),$post:t=>n(o,r,y,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(r).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},session:{post:t=>n(o,d,y,t).json(),$post:t=>n(o,d,y,t).json().then(t=>t.body),delete:t=>n(o,d,m,t).json(),$delete:t=>n(o,d,m,t).json().then(t=>t.body),$path:()=>"".concat(o).concat(d)},tasks:{_taskId:t=>{let e="".concat(u,"/").concat(t);return{patch:t=>n(o,e,f,t).json(),$patch:t=>n(o,e,f,t).json().then(t=>t.body),delete:t=>n(o,e,m,t).json(),$delete:t=>n(o,e,m,t).json().then(t=>t.body),$path:()=>"".concat(o).concat(e)}},di:{get:t=>n(o,p,"GET",t).json(),$get:t=>n(o,p,"GET",t).json().then(t=>t.body),$path:()=>"".concat(o).concat(p)},get:t=>n(o,u,"GET",t).json(),$get:t=>n(o,u,"GET",t).json().then(t=>t.body),post:t=>n(o,u,y,t).json(),$post:t=>n(o,u,y,t).json().then(t=>t.body),patch:t=>n(o,u,f,t).json(),$patch:t=>n(o,u,f,t).json().then(t=>t.body),delete:t=>n(o,u,m,t).json(),$delete:t=>n(o,u,m,t).json().then(t=>t.body),$path:t=>"".concat(o).concat(u).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},test:{post:t=>n(o,h,y,t,"FormData").send(),$post:t=>n(o,h,y,t,"FormData").send().then(t=>t.body),$path:()=>"".concat(o).concat(h)},user:{get:t=>n(o,g,"GET",t).json(),$get:t=>n(o,g,"GET",t).json().then(t=>t.body),post:t=>n(o,g,y,t).send(),$post:t=>n(o,g,y,t).send().then(t=>t.body),$path:t=>"".concat(o).concat(g).concat(t&&t.query?"?".concat((0,a._K)(t.query)):"")},get:t=>n(o,"","GET",t).text(),$get:t=>n(o,"","GET",t).text().then(t=>t.body),$path:()=>"".concat(o)}})((0,o.Z)(s.Z.create({withCredentials:!0})))},2745:function(t,e,n){"use strict";n.d(e,{N:function(){return formatContent},m:function(){return formatTime}});let formatTime=t=>{let e=new Date(t);return new Intl.DateTimeFormat("ja-JP",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",hour12:!0}).format(e)},formatContent=t=>{let e="";for(let n=0;n<t.length;n+=17){let o=t.substring(n,n+17);e+=o+(n+17<t.length?"\n":"")}return e}},6819:function(t,e,n){"use strict";n.d(e,{F:function(){return returnNull}});let returnNull=()=>null},5123:function(t){t.exports={mapButton:"ar_mapButton__k_EPZ",coordinatesInfo:"ar_coordinatesInfo__1KWgl"}},8046:function(t){t.exports={container:"Loading_container__wV1ri",loader:"Loading_loader__cpdbt",load:"Loading_load__8NQtO"}}},function(t){t.O(0,[911,583,664,774,888,179],function(){return t(t.s=4747)}),_N_E=t.O()}]);